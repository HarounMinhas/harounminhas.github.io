services:
  - type: web
    name: musicdiscovery-api
    runtime: node
    region: frankfurt
    plan: free
    buildCommand: |
      corepack enable pnpm && \
      pnpm install --no-frozen-lockfile && \
      pnpm build --filter=@musicdiscovery/api...
    startCommand: node apps/api/dist/index.js
    envVars:
      - key: NODE_ENV
        value: production
      # Optional: set this securely in the Render dashboard (do not commit a value).
      - key: LASTFM_API_KEY
        sync: false
      # Optional: Discogs Personal Access Token (recommended to avoid strict anonymous rate limits).
      - key: DISCOGS_TOKEN
        sync: false
      # Optional: Redis connection URL for caching fallback provider results.
      - key: REDIS_URL
        sync: false
      # Optional: Fallback provider cache TTLs (seconds).
      - key: FALLBACK_LASTFM_TTL_SECONDS
        value: "3600"
      - key: FALLBACK_MUSICBRAINZ_TTL_SECONDS
        value: "7200"
      - key: FALLBACK_DISCOGS_TTL_SECONDS
        value: "7200"
