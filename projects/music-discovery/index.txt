3:I[4707,[],""]
4:I[6423,[],""]
5:I[2972,["972","static/chunks/972-c3cb8c108462ccf6.js","931","static/chunks/app/page-69188fe929472fca.js"],""]
6:I[7487,["972","static/chunks/972-c3cb8c108462ccf6.js","185","static/chunks/app/layout-02c9f13f66059869.js"],"default"]
7:I[5435,["972","static/chunks/972-c3cb8c108462ccf6.js","185","static/chunks/app/layout-02c9f13f66059869.js"],"default"]
0:["17gEIcmXHQeOc7qJ0k7nB",[[["",{"children":["projects",{"children":["music-discovery",{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",{"children":["projects",{"children":["music-discovery",{"children":["__PAGE__",{},[["$L1","$L2",[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/5641f0c8fb166280.css","precedence":"next","crossOrigin":"$undefined"}]]],null],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","projects","children","music-discovery","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","projects","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/e085a50399b26c8f.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","link",null,{"id":"bootstrap-theme","rel":"stylesheet","href":"https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/flatly/bootstrap.min.css"}],["$","link",null,{"rel":"stylesheet","href":"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"}]]}],["$","body",null,{"className":"antialiased bg-gray-50 text-gray-900","children":[["$","div",null,{"className":"bg-primary text-white text-center py-1 w-100","children":"Example of what can be done with Codex - local"}],["$","header",null,{"className":"border-b bg-white","children":["$","div",null,{"className":"mx-auto flex max-w-5xl items-center justify-between gap-2 p-4","children":[["$","$L5",null,{"href":"/","className":"text-xl font-semibold","children":"Projects"}],["$","div",null,{"className":"flex items-center gap-2","children":[["$","$L6",null,{}],["$","$L7",null,{}]]}]]}]}],["$","main",null,{"className":"mx-auto max-w-5xl p-4","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[]}]}]]}]]}]],null],null],["$L8",null]]]]
8:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"MusicDiscovery Blueprint"}],["$","meta","3",{"name":"description","content":"Blueprint en runbook voor de MusicDiscovery app"}]]
1:null
9:I[3072,["434","static/chunks/434-e3000e1272edfcbe.js","446","static/chunks/446-9c235b9240680f71.js","454","static/chunks/app/projects/music-discovery/page-6396422def04f0c5.js"],"default"]
a:I[2255,["434","static/chunks/434-e3000e1272edfcbe.js","446","static/chunks/446-9c235b9240680f71.js","454","static/chunks/app/projects/music-discovery/page-6396422def04f0c5.js"],"default"]
b:T4e6b,# MusicDiscovery Project Blueprint

---

## 1. Productvisie en scope

**Doel**

Interactieve muziekontdekkingsapp. Je start bij een artiest, ziet gelijkaardige artiesten als een sleepbare graaf, klikt door het netwerk en beluistert 30-seconden previews. Je kunt nodes vastpinnen, favorieten bewaren, mini-playlists maken en delen.

**Primaire databron**

- Spotify Web API met Client Credentials Flow voor server-side calls. Voor preview gebruik je `preview_url` van Spotify tracks.
- **Audius Public API** (gratis en open source) als extra bron voor trending tracks, remixes en community-curated playlists zonder commerciële beperkingen. Gebruik deze als alternatief wanneer Spotify rate-limt of wanneer je een demo zonder accounts wilt draaien.
- Optioneel Last.fm en MusicBrainz als fallback of enrichment.

**Platformen**

- Webapp: React + Vite
- Mobiel: React Native of .NET MAUI (beide haalbaar op basis van dezelfde backend)
- Backend: Node.js + TypeScript (NestJS of Express), of .NET 8 Web API als alternatief
- Database: PostgreSQL
- Cache: Redis

---

## 2. Persona’s

1. **Casual Explorer**
    
    Wil snel nieuwe artiesten ontdekken via klikken in de graaf, af en toe een preview luisteren, niets verplicht inloggen.
    
2. **Power Listener**
    
    Wil chain-discovery, pins, notities, mini-playlists en export naar Spotify.
    
3. **Curator**
    
    Wil vergelijkingen, thema’s, tags opslaan, b.v. “Indie folk om te studeren”.
    
---

## 3. Use cases en user stories

### UC-01 Artiest zoeken

- Als gebruiker wil ik een artiest zoeken zodat ik die als vertrekpunt kan nemen.
- Acceptatie:
    - Zoek met autosuggest.
    - Enter of klik op resultaat zet die artiest als centrale node.

### UC-02 Gelijkaardige artiesten zien

- Als gebruiker wil ik rond de centrale artiest 8 tot 12 gelijkaardige artiesten zien zodat ik verder kan verkennen.
- Acceptatie:
    - Nodes met ronde avatars, labels.
    - Edges tussen centrum en buren.
    - Geen duplicaten.

### UC-03 Node interacties

- Als gebruiker wil ik nodes kunnen verslepen en pinnen voor een eigen lay-out.
- Als gebruiker wil ik op een node klikken en een contextmenu zien met: titel, Listen, More Similar Artists.
- Acceptatie:
    - Drag met veer-effect.
    - Pin zet de node vast.
    - Contextmenu sluit bij buitenklik of ESC.

### UC-04 Meer gelijkaardigen laden

- Als gebruiker wil ik op “More Similar Artists” klikken om die node tot pivot te maken en nieuwe buren te zien.
- Acceptatie:
    - Lazy load, dedupe, animatie van edges.
    - Nieuwe buren verschijnen in een ring rond de pivot.

### UC-05 Luisterpreview

- Als gebruiker wil ik 30-sec previews afspelen met play/pause en volume.
- Acceptatie:
    - Eén globale player, nieuw nummer stopt het vorige.
    - Indien geen preview: disabled actie en link “Open in Spotify”.

### UC-06 Favorieten en pins

- Als gebruiker wil ik artiesten en playlists kunnen bewaren en nodes pinnen zodat ik later kan terugkeren.
- Acceptatie:
    - Favoriet-toggle per artiest.
    - Behouden van pin status per sessie en per opgeslagen graaf.

### UC-07 Sessies en graaf-snapshots

- Als gebruiker wil ik mijn huidige graaf kunnen opslaan als snapshot en later opnieuw openen.
- Acceptatie:
    - Slaat nodes, posities, pins en timestamp op.
    - Delen via deeplink.

### UC-08 Exporteren naar Spotify

- Als power user wil ik de geselecteerde tracks kunnen exporteren naar een Spotify playlist.
- Acceptatie:
    - Vereist OAuth Authorization Code flow.
    - Gebruiker kiest naam, playlist wordt aangemaakt.

### UC-09 Fallback en errors

- Als gebruiker wil ik duidelijke meldingen bij API errors en rate limits.
- Acceptatie:
    - Netwerkfouten tonen toasts met retry.
    - Rate limit backoff en waarschuwing.

### UC-10 Toegankelijkheid

- Als gebruiker met toetsenbord wil ik nodes en menu’s kunnen bedienen.
- Acceptatie:
    - Focus states, ARIA labels, contrast AA.

---

## 4. Functionele eisen

- Sleepbare, zoomable graaf met collision-avoidance.
- Radiale ring rond pivot bij eerste plaatsing, daarna lichte force simulatie.
- Dedupe op artiest-id door volledige graaf.
- Cache per artiest: related en top tracks.
- Player met progress bar en volume.
- Zoek met debounced autosuggest.
- Snapshots en favorieten server-side opgeslagen per gebruiker.
- Optioneel gastmodus met localStorage.

---

## 5. Niet-functionele eisen

- TTFB voor initieel scherm onder 200 ms vanaf CDN.
- API p95 < 300 ms voor cached routes, < 800 ms voor uncached.
- 60 fps animatie bij < 200 nodes op gemiddelde laptop.
- A11y WCAG 2.1 AA.
- Meertaligheid: NL, EN.
- GDPR: enkel functionele data, geen gevoelige persoonsgegevens.

---

## 6. Informatiearchitectuur en schermen

### 6.1 Web UI lay-out

- Header: logo, zoekbalk, user menu.
- Main:
    - Linker 70 procent: graaf canvas.
    - Rechter 30 procent: zijpaneel player en details.
- Footer: volumeregelaar en transport.

### 6.2 Belangrijke schermen

1. Home: lege staat met zoekfocus.
2. Discovery: graaf + details.
3. Favorieten: lijst van artiesten.
4. Snapshots: opgeslagen grafen met thumbnails.
5. OAuth callback scherm.
6. Settings: taal, thema licht/donker, marktcode voor top tracks.

---

## 7. UX-interacties

- Node hover: vergroting 1.05, rand highlight, edges highlight.
- Node drag: pointer-cursor, physics pauseren tot drop.
- Contextmenu: vaste breedte 260 px, titelregel, actieknoppen.
- Keyboard:
    - Pijlen bewegen focus tussen nodes.
    - Enter opent contextmenu.
    - Space togglet play op geselecteerde track.
- Empty states: duidelijke icon + boodschap + call to action.

---

## 8. Architectuur

```
[Client] React SPA
   |
   | HTTPS JSON
   v
[API] Node/TS (NestJS of Express)
   |\
   | \__ Audius proxy (open API)
   |      v
   |    [Audius Public API]
   |
   | Redis cache
   v
[PostgreSQL] gebruikers, snapshots, favorieten
   |
   | Spotify OAuth tokens
   v
[Spotify Web API]

```

- Server doet Spotify calls met Client Credentials voor publieke data.
- Audius proxy gebruikt openbare endpoints en slaat geen secrets op; alleen caching/normalisatie in backend.
- Voor user-acties zoals playlist creatie gebruik je Authorization Code flow.

---

## 9. Datamodel (PostgreSQL, Prisma-stijl)

```
model User {
  id            String   @id @default(cuid())
  provider      String   // 'anonymous' of 'spotify'
  email         String?  @unique
  displayName   String?
  avatarUrl     String?
  locale        String   @default("nl")
  market        String   @default("BE")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  snapshots     Snapshot[]
  favorites     Favorite[]
  settings      Json?
  // OAuth tokens apart:
  spotifyAuth   SpotifyAuth?
}

model SpotifyAuth {
  id           String   @id @default(cuid())
  userId       String   @unique
  accessToken  String
  refreshToken String
  scope        String
  expiresAt    DateTime
  user         User     @relation(fields: [userId], references: [id])
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  artistId  String   // Spotify artist id
  name      String
  imageUrl  String?
  addedAt   DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
  @@unique([userId, artistId])
}

model Snapshot {
  id         String   @id @default(cuid())
  userId     String
  title      String
  createdAt  DateTime @default(now())
  graphJson  Json     // nodes, edges, posities, pins
  previewUrl String?  // optioneel thumbnail
  user       User     @relation(fields: [userId], references: [id])
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String?
  action    String
  payload   Json?
  createdAt DateTime @default(now())
}

```

---

## 10. Frontend datamodellen (TypeScript)

```tsx
export type Artist = {
  id: string;
  name: string;
  imageUrl?: string;
  genres?: string[];
  popularity?: number;
};

export type Track = {
  id: string;
  name: string;
  previewUrl?: string;
  durationMs: number;
  artists: { id: string; name: string }[];
};

export type NodeData = {
  id: string;           // unique per graph node
  artistId: string;     // Spotify id
  name: string;
  imageUrl?: string;
  pinned?: boolean;
  x?: number; y?: number; fx?: number; fy?: number;
};

export type EdgeData = { source: string; target: string };

export type GraphState = {
  nodes: NodeData[];
  edges: EdgeData[];
  pivotNodeId: string;
  loadedNeighbors: Record<string, string[]>; // artistId -> neighbor ids
};

```

---

## 11. API specificatie (REST)

Alle routes onder `/api`. Responses zijn JSON. Tijdsformaat ISO 8601. Auth via JWT of session cookie. Rate limit 60 req/min per IP.

### 11.1 Auth en gebruikers

- `POST /auth/anonymous`
    - Resultaat: `{ token, user: User }`
- `GET /auth/spotify/login`
    - Redirect naar Spotify
- `GET /auth/spotify/callback?code=...`
    - Resultaat: set session, redirect naar app
- `POST /auth/logout`

### 11.2 Spotify proxy

Server-side om client te ontlasten en secrets te verbergen.

- `GET /spotify/search?query=ben%20howard&type=artist&limit=10`
    - Resultaat: `[{ id, name, imageUrl, genres, popularity }]`
- `GET /spotify/artists/:id`
    - Resultaat: `{ id, name, imageUrl, genres, popularity }`
- `GET /spotify/artists/:id/related`
    - Resultaat: `[{ ...Artist }]`
- `GET /spotify/artists/:id/top-tracks?market=BE`
    - Resultaat: `[{ ...Track }]`
- `GET /spotify/tracks/:id`
- `GET /spotify/audio-features/:id` (optioneel, voor eigen similarity)

Caching: Redis 24 uur voor `related` en 6 uur voor `top-tracks`.

### 11.3 Audius proxy (open API)

Gebruik de gratis Audius API via https://discoveryprovider.audius.co. Geen auth vereist, maar voeg een eenvoudige rate limiter toe.

- `GET /audius/tracks/trending?genre=electronic&limit=20`
    - Resultaat: lijst met trending tracks inclusief `title`, `user`, `stream_url`.
- `GET /audius/users/:handle/tracks`
    - Resultaat: tracks per artiest/creator voor graafuitbreiding.
- `GET /audius/tracks/:id/stream`
    - Resultaat: directe stream-URL voor previews.

Cache responses max 10 minuten; Audius data verandert sneller en is toch gratis beschikbaar.

### 11.4 App-data

- `GET /me`
    - Resultaat: `User`
- `GET /favorites`
- `POST /favorites`
    - Body: `{ artistId, name, imageUrl }`
- `DELETE /favorites/:artistId`
- `GET /snapshots`
- `POST /snapshots`
    - Body: `{ title, graphJson }`
- `GET /snapshots/:id`
- `DELETE /snapshots/:id`

### 11.5 Export

- `POST /export/spotify-playlist`
    - Auth vereist met Spotify scope `playlist-modify-public` of `playlist-modify-private`
    - Body: `{ name, trackIds: string[] }`
    - Resultaat: `{ playlistId, externalUrl }`

### 11.6 Foutcodes

- `400` validation_error
- `401` unauthorized
- `403` forbidden
- `404` not_found
- `409` conflict
- `429` rate_limited
- `500` server_error
    
    Body altijd `{ error: { code, message, details? } }`.
    
---

## 12. Integratie met Spotify

### 12.1 OAuth

- Voor data zonder usercontext: **Client Credentials Flow** op de server.
- Voor playlist export of user-gegevens: **Authorization Code Flow** met refresh tokens.

### 12.2 Relevante endpoints

- `GET /v1/search?type=artist&q=...`
- `GET /v1/artists/{id}`
- `GET /v1/artists/{id}/related-artists`
- `GET /v1/artists/{id}/top-tracks?market=BE`
- `GET /v1/tracks/{id}`
- `GET /v1/audio-features/{id}`

Voorbeelden van genormaliseerde server-responses zijn hierboven gegeven. Bewaar geen Spotify secrets in de client.

### 12.3 Audius integratie (optioneel)

- Geen OAuth vereist, maar voeg een `User-Agent` header toe en respecteer `X-RateLimit` headers.
- Normaliseer Audius response naar hetzelfde `Artist` en `Track` model (gebruik `user.name` als artiest, `stream_url` voor previews).
- Markeer Audius-content in de UI (bijv. badge "Audius") zodat gebruikers weten dat het community-sourced is.
- Gebruik Audius vooral in gastmodus of wanneer Spotify preview ontbreekt; fallback logic: eerst Spotify preview, anders Audius stream.

---

## 13. Algorithmische details

### 13.1 Initieel plaatsen

- Plaats pivot op canvas-centrum.
- Plaats n buren op een cirkel met straal `R = k * sqrt(n)` en verdeling `angle = 2πi/n`.
- Sla posities op in node.x, node.y en laat daarna een lichte force simulatie lopen.

### 13.2 Force simulatie

- Use case: overlap vermijden, organisch effect.
- Krachten:
    - Link force met lengte 150
    - Charge negative 30
    - Collision radius gelijk aan node-diameter + 4
- Tijdens drag: zet fx, fy op muispositie. Bij drop verwijder fx, fy tenzij pinned.

### 13.3 Dedupe

- Nieuwe neighbor set: filter op `artistId` die al in `graphState.nodes` zit.
- Edges: voeg enkel toe als combinatie nog niet bestaat.

### 13.4 Prefetch en cache

- Wanneer node in viewport en niet geladen: prefetch `related` en `top-tracks`.
- Cache key: `artist:{id}:related` en `artist:{id}:topTracks:{market}`.

---

## 14. Componentarchitectuur (React)

```
<App>
  <Header>
    <SearchBar />
    <UserMenu />
  </Header>

  <Main>
    <GraphCanvas
      graphState
      onNodeClick
      onNodeDrag
      onPinToggle
      onContextAction
    />
    <SidePanel>
      <ArtistHeader />
      <TopTracks />
      <Actions />
    </SidePanel>
  </Main>

  <Footer>
    <GlobalPlayer />
  </Footer>
</App>

```

State management:

- React Query voor data-fetch en cache.
- Zustand of Redux Toolkit voor `GraphState` en player.

---

## 15. UI-richtlijnen

- Node afmetingen: 96 px standaard, 120 px voor pivot.
- Label max 20 tekens, ellipsis na 1 regel.
- Edge 1 px lichtgrijs, opacity 0.6.
- Thema licht en donker. Contrast minimaal AA.
- Animaties: 150 tot 250 ms ease-in-out.
- Contextmenu met duidelijke hit targets, 40 px hoogte per item.

---

## 16. Toegankelijkheid

- Alle interacties via keyboard mogelijk.
- Node als `button` met `aria-label="Artist: {name}"`.
- Contextmenu met roving tabindex.
- Focusring 2 px zichtbaar.
- Voor player: `aria-live="polite"` bij trackwissel.

---

## 17. Internationalisatie

- i18n keys in JSON, fallback EN.
- Marktcode voor top tracks instelbaar in Settings.
- Datum en getallen via Intl API.

---

## 18. Beveiliging en privacy

- OAuth tokens server-side versleuteld (AES-GCM) met roterende key.
- Cookies `HttpOnly`, `Secure`, `SameSite=Lax`.
- CORS strikt op frontend origin.
- Rate limiting en bot-protect op public routes.
- CSP headers, Referrer-Policy, X-Content-Type-Options.
- Log geen volledige tokens in audit.

---

## 19. Performance en schaalbaarheid

- Vite bundling, code-splitting, lazy load voor SidePanel.
- Afbeeldingen via `<img srcset>` en CDNs, of proxied met cache.
- Canvas rendering voor graaf bij > 100 nodes.
- API caching op Redis. Warm caches voor populaire artiesten.

---

## 20. Teststrategie

### 20.1 Unit

- Pure helpers: dedupe, layout, mappers van Spotify naar interne modellen.

### 20.2 Integratie

- API routes met mocked Spotify via MSW of WireMock.

### 20.3 E2E

- Playwright:
    - Zoek artiest, laad graaf, klik node, luister preview, snapshot bewaren.

### 20.4 Performancetests

- Lighthouse en WebPageTest.
- K6 voor backend, scenario met 50 rps bursts.

### 20.5 Toegankelijkheid

- axe-core geautomatiseerd in CI.

---

## 21. Telemetrie en analytics

- Eventen: search_performed, node_opened, neighbors_loaded, track_preview_played, snapshot_saved, export_playlist.
- Privacyvriendelijk, zonder PII.
- Error tracking met Sentry.

---

## 22. CI/CD en deployment

- Monorepo met Turbo of Nx.
- CI: lint, typecheck, test, build, audit.
- Docker images voor api en web.
- Docker Compose voor dev.
- Prod op Fly.io, Railway, Azure of AWS.
- Migraties via Prisma Migrate.

**Omgevingsvariabelen**

```
SPOTIFY_CLIENT_ID=
SPOTIFY_CLIENT_SECRET=
SPOTIFY_REDIRECT_URI=https://app.example.com/auth/spotify/callback
JWT_SECRET=
DATABASE_URL=postgres://...
REDIS_URL=redis://...
BASE_URL=https://api.example.com

```

---

## 23. Backlog en roadmap

### MVP

- Zoek, discovery graaf, drag, contextmenu, listen, top tracks, favorieten lokaal.
- Spotify proxy met Client Credentials.
- Gastmodus.

### V1

- Accounts, server-side favorieten en snapshots.
- Deelbare deeplinks.
- Donker thema, i18n.

### V2

- Spotify playlist export via OAuth.
- Fallback naar Last.fm bij lege related.
- Eigen similarity op basis van audio features.

---

## 24. Acceptatiecriteria per kernfeature

- **Zoek**: binnen 300 ms resultaten bij cache hit, geen XSS via query, keyboard navigatie ok.
- **Graaf**: geen overlappende nodes in rust, drag performant, dedupe 100 procent.
- **Listen**: preview start onder 200 ms bij cache hit, visual feedback playing.
- **Snapshots**: POST met 201, GET levert identieke lay-out terug.
- **Export**: playlist verschijnt in Spotify account en bevat juiste tracks.

---

## 25. Voorbeeld payloads

### 25.1 `GET /spotify/search?query=ben howard&type=artist`

```json
{
  "items": [
    {
      "id": "5schHn4kqRZfzJ6Tu2B3Yl",
      "name": "Ben Howard",
      "imageUrl": "https://i.scdn.co/image/...",
      "genres": ["indie folk", "singer-songwriter"],
      "popularity": 67
    }
  ]
}

```

### 25.2 `GET /spotify/artists/{id}/related`

```json
{
  "items": [
    { "id": "0Z8k3Hc2", "name": "Bear's Den", "imageUrl": "..." },
    { "id": "1aS9", "name": "Nick Mulvey", "imageUrl": "..." }
  ]
}

```

### 25.3 `GET /spotify/artists/{id}/top-tracks?market=BE`

```json
{
  "items": [
    {
      "id": "3abc",
      "name": "Only Love",
      "previewUrl": "https://p.scdn.co/mp3-preview/...",
      "durationMs": 229000,
      "artists": [{ "id": "5sch...", "name": "Ben Howard" }]
    }
  ]
}

```

---

## 26. Pseudocode kerndelen

### 26.1 Neighbors laden en toevoegen

```tsx
async function expandNode(pivotArtistId: string) {
  if (graph.loadedNeighbors[pivotArtistId]) return;

  const res = await api.getRelated(pivotArtistId);
  const newArtists = res.items.filter(a => !graph.nodes.some(n => n.artistId === a.id));

  const newNodes = newArtists.map((a, i) => ({
    id: cuid(), artistId: a.id, name: a.name, imageUrl: a.imageUrl,
    ...radialPosition(i, newArtists.length, pivotPosition())
  }));

  graph.nodes.push(...newNodes);
  graph.edges.push(...newNodes.map(n => ({ source: findNodeIdByArtist(pivotArtistId), target: n.id })));
  graph.loadedNeighbors[pivotArtistId] = newArtists.map(a => a.id);
}

```

### 26.2 Player

```tsx
let audio = new Audio();
function playPreview(track: Track) {
  if (!track.previewUrl) return;
  audio.src = track.previewUrl;
  audio.play();
}
function pause() { audio.pause(); }

```

---

## 27. Styling en design system

- Tailwind of CSS Variables.
- Components: Button, Card, Menu, Tooltip, Tabs, Dialog.
- Schaduwen zacht, afgeronde hoeken xl.
- Preflight fonts: Inter of System UI.

---

## 28. Mobiele app aandachtspunten

- Zelfde backend.
- React Native: gebruik `react-native-svg` of `expo-three` voor graaf, of vereenvoudigde lijst-navigatie met horizontale carrousel als performance beperkt is.
- .NET MAUI: canvas via SkiaSharp voor de graaf.
- Offline: cache van laatst bezochte artiesten en snapshots in SQLite.

---

## 29. Licenties en content

- Spotify preview_url en images mogen als preview gebruikt worden volgens Spotify TOS. Link altijd naar de artiest of track in Spotify bij detailweergave. Bewaar geen audio lokaal.

---

## 30. Things to remember tijdens implementatie

- Duidelijke loading states en skeletons bij zijpaneel.
- Dedupe strikt op Spotify artist id.
- Backoff bij `429` met `Retry-After`.
- Log elke Spotify call met endpoint, status, duur.
- Feature flags voor export en eigen similarity.

---

## 31. Checklist om te starten

1. Spotify app registreren en Client ID/Secret invullen.
2. Backend scaffolding opzetten met healthcheck en één proxy route.
3. Redis en Postgres draaien via Docker.
4. Frontend met Vite, React Query, router.
5. Basisgraaf renderen met dummy data.
6. Echte `search` en `related` inbouwen.
7. Player en SidePanel toevoegen.
8. Favorieten en snapshots aansluiten op database.
9. CI/CD pipeline.
10. Lighthouse, axe en Playwright in CI.
2:["$","div",null,{"className":"space-y-8","children":[["$","$L9",null,{"className":"mx-auto mt-4 max-w-3xl"}],["$","header",null,{"className":"space-y-3 rounded-xl border border-slate-200 bg-white p-6 shadow-sm","children":[["$","h1",null,{"className":"text-3xl font-semibold text-gray-900","children":"MusicDiscovery"}],["$","p",null,{"className":"text-base text-gray-600","children":"Ontdek nieuwe artiesten via een interactieve graaf, beluister 30-seconden previews en bewaar snapshots van je ontdekkingstocht. De blueprint blijft beschikbaar als referentie maar de app hieronder is volledig interactief en draait op mockdata wanneer er geen backend aanwezig is."}]]}],["$","$La",null,{"blueprint":"$b"}]]}]
