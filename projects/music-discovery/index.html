<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/5f654fdea15757e9.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/5641f0c8fb166280.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-00e3fd8b4ba0e61a.js"/><script src="/_next/static/chunks/fd9d1056-4a3f9467a1304b8b.js" async=""></script><script src="/_next/static/chunks/117-938e66524e7a2620.js" async=""></script><script src="/_next/static/chunks/main-app-76cd622bf10842cb.js" async=""></script><script src="/_next/static/chunks/972-c3cb8c108462ccf6.js" async=""></script><script src="/_next/static/chunks/app/page-69188fe929472fca.js" async=""></script><script src="/_next/static/chunks/app/layout-02c9f13f66059869.js" async=""></script><script src="/_next/static/chunks/434-e3000e1272edfcbe.js" async=""></script><script src="/_next/static/chunks/446-9c235b9240680f71.js" async=""></script><script src="/_next/static/chunks/app/projects/music-discovery/page-2aa7948ae3251eea.js" async=""></script><title>MusicDiscovery Blueprint</title><meta name="description" content="Blueprint en runbook voor de MusicDiscovery app"/><link id="bootstrap-theme" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/flatly/bootstrap.min.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="antialiased bg-gray-50 text-gray-900"><div class="bg-primary text-white text-center py-1 w-100">Example of what can be done with Codex - local</div><header class="border-b bg-white"><div class="mx-auto flex max-w-5xl items-center justify-between gap-2 p-4"><a class="text-xl font-semibold" href="/">Projects</a><div class="flex items-center gap-2"><select class="form-select w-auto"><option value="flatly" selected="">Light</option><option value="darkly">Dark</option><option value="cyborg">Darker</option></select><div class="relative"><form class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-2 text-gray-500"><i class="bi bi-search"></i></span><input type="text" placeholder="Search..." class="w-48 rounded border pl-8 pr-3 py-1 text-sm" aria-label="Search opportunities" value=""/></form></div></div></div></header><main class="mx-auto max-w-5xl p-4"><div class="space-y-8"><div class="rounded-lg border border-sky-200 bg-sky-50 px-4 py-3 text-sm text-sky-900 shadow-sm mx-auto mt-4 max-w-3xl"><p class="text-sm font-semibold text-sky-900">Versie gedeployed op:</p><p class="mt-1 text-sm text-sky-800">Versie-informatie niet beschikbaar</p></div><header class="space-y-3 rounded-xl border border-slate-200 bg-white p-6 shadow-sm"><h1 class="text-3xl font-semibold text-gray-900">MusicDiscovery</h1><p class="text-base text-gray-600">Ontdek nieuwe artiesten via een interactieve graaf, beluister 30-seconden previews en bewaar snapshots van je ontdekkingstocht. De blueprint blijft beschikbaar als referentie maar de app hieronder is volledig interactief en draait op mockdata wanneer er geen backend aanwezig is.</p></header><div class="space-y-6"><div class="styles_toolbar__KJHd1"><div><h2 class="text-xl font-semibold text-slate-100">MusicDiscovery</h2><p class="mt-1 text-sm text-slate-300">Kies een muziek API om te starten. Beschikbaar zijn zowel open bronnen zonder token als platform-API&#x27;s met OAuth.</p></div><div class="styles_apiPicker__E3J5_"><span class="styles_apiPickerLabel__S84LC">Selecteer muziek API</span><ul class="styles_apiList__XE2nC" role="list"><li><button class="styles_apiButton__04h5m " type="button" aria-pressed="false"><div class="styles_apiButtonHeader__itLjD"><span>MusicBrainz API</span><span class="styles_apiBadge___Zs2H" aria-label="Geen token of key nodig" title="Geen token of key nodig">üîì</span></div><p class="styles_apiDescription__3jv0Q">Open muziekencyclopedie zonder authenticatie, ideaal voor metadata en artiestrelaties.</p><span class="styles_apiDocs__ITuJm" aria-hidden="true">Documentatie ¬∑ <!-- -->musicbrainz.org</span></button></li><li><button class="styles_apiButton__04h5m " type="button" aria-pressed="false"><div class="styles_apiButtonHeader__itLjD"><span>iTunes Search API</span><span class="styles_apiBadge___Zs2H" aria-label="Geen token of key nodig" title="Geen token of key nodig">üîì</span></div><p class="styles_apiDescription__3jv0Q">Publieke catalogus van Apple Music/iTunes zonder token, perfect voor snelle zoekopdrachten.</p><span class="styles_apiDocs__ITuJm" aria-hidden="true">Documentatie ¬∑ <!-- -->developer.apple.com</span></button></li><li><button class="styles_apiButton__04h5m " type="button" aria-pressed="false"><div class="styles_apiButtonHeader__itLjD"><span>Songsterr Tabs API</span><span class="styles_apiBadge___Zs2H" aria-label="Geen token of key nodig" title="Geen token of key nodig">üîì</span></div><p class="styles_apiDescription__3jv0Q">Gitaar-tabs, akkoorden en artiestinformatie zonder API-sleutel, ideaal voor creatieve inspiratie.</p><span class="styles_apiDocs__ITuJm" aria-hidden="true">Documentatie ¬∑ <!-- -->www.songsterr.com</span></button></li><li><button class="styles_apiButton__04h5m " type="button" aria-pressed="false"><div class="styles_apiButtonHeader__itLjD"><span>Spotify Web API</span><span class="styles_apiBadgeLocked__e4Vh3" aria-label="Token of API-sleutel vereist" title="Token of API-sleutel vereist">üîê</span></div><p class="styles_apiDescription__3jv0Q">Volledige catalogus met streaming metadata, vereist OAuth-token voor toegang.</p><span class="styles_apiDocs__ITuJm" aria-hidden="true">Documentatie ¬∑ <!-- -->developer.spotify.com</span></button></li><li><button class="styles_apiButton__04h5m " type="button" aria-pressed="false"><div class="styles_apiButtonHeader__itLjD"><span>Last.fm API</span><span class="styles_apiBadgeLocked__e4Vh3" aria-label="Token of API-sleutel vereist" title="Token of API-sleutel vereist">üîê</span></div><p class="styles_apiDescription__3jv0Q">Community-statistieken, scrobbles en aanbevelingen via een eenvoudige REST API (API-key vereist).</p><span class="styles_apiDocs__ITuJm" aria-hidden="true">Documentatie ¬∑ <!-- -->www.last.fm</span></button></li></ul></div></div><div><div class="styles_selectionNoticeMuted__dCw_N">Selecteer een API hierboven om de ervaring te starten.</div></div></div></div></main><script src="/_next/static/chunks/webpack-00e3fd8b4ba0e61a.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/5f654fdea15757e9.css\",\"style\"]\n2:HL[\"/_next/static/css/5641f0c8fb166280.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"3:I[2846,[],\"\"]\n6:I[4707,[],\"\"]\n7:I[6423,[],\"\"]\n8:I[2972,[\"972\",\"static/chunks/972-c3cb8c108462ccf6.js\",\"931\",\"static/chunks/app/page-69188fe929472fca.js\"],\"\"]\n9:I[7487,[\"972\",\"static/chunks/972-c3cb8c108462ccf6.js\",\"185\",\"static/chunks/app/layout-02c9f13f66059869.js\"],\"default\"]\na:I[5435,[\"972\",\"static/chunks/972-c3cb8c108462ccf6.js\",\"185\",\"static/chunks/app/layout-02c9f13f66059869.js\"],\"default\"]\nc:I[1060,[],\"\"]\nd:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L3\",null,{\"buildId\":\"XaH3_54lZCr8jwMmZfike\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"projects\",\"music-discovery\",\"\"],\"initialTree\":[\"\",{\"children\":[\"projects\",{\"children\":[\"music-discovery\",{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"projects\",{\"children\":[\"music-discovery\",{\"children\":[\"__PAGE__\",{},[[\"$L4\",\"$L5\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/5641f0c8fb166280.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]],null],null]},[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"projects\",\"children\",\"music-discovery\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"projects\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/5f654fdea15757e9.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"id\":\"bootstrap-theme\",\"rel\":\"stylesheet\",\"href\":\"https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/flatly/bootstrap.min.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css\"}]]}],[\"$\",\"body\",null,{\"className\":\"antialiased bg-gray-50 text-gray-900\",\"children\":[[\"$\",\"div\",null,{\"className\":\"bg-primary text-white text-center py-1 w-100\",\"children\":\"Example of what can be done with Codex - local\"}],[\"$\",\"header\",null,{\"className\":\"border-b bg-white\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto flex max-w-5xl items-center justify-between gap-2 p-4\",\"children\":[[\"$\",\"$L8\",null,{\"href\":\"/\",\"className\":\"text-xl font-semibold\",\"children\":\"Projects\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center gap-2\",\"children\":[[\"$\",\"$L9\",null,{}],[\"$\",\"$La\",null,{}]]}]]}]}],[\"$\",\"main\",null,{\"className\":\"mx-auto max-w-5xl p-4\",\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]}]]}]]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Lb\"],\"globalErrorComponent\":\"$c\",\"missingSlots\":\"$Wd\"}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"MusicDiscovery Blueprint\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Blueprint en runbook voor de MusicDiscovery app\"}]]\n4:null\n"])</script><script>self.__next_f.push([1,"e:I[3072,[\"434\",\"static/chunks/434-e3000e1272edfcbe.js\",\"446\",\"static/chunks/446-9c235b9240680f71.js\",\"454\",\"static/chunks/app/projects/music-discovery/page-2aa7948ae3251eea.js\"],\"default\"]\nf:I[2255,[\"434\",\"static/chunks/434-e3000e1272edfcbe.js\",\"446\",\"static/chunks/446-9c235b9240680f71.js\",\"454\",\"static/chunks/app/projects/music-discovery/page-2aa7948ae3251eea.js\"],\"default\"]\n10:T4e6b,"])</script><script>self.__next_f.push([1,"# MusicDiscovery Project Blueprint\n\n---\n\n## 1. Productvisie en scope\n\n**Doel**\n\nInteractieve muziekontdekkingsapp. Je start bij een artiest, ziet gelijkaardige artiesten als een sleepbare graaf, klikt door het netwerk en beluistert 30-seconden previews. Je kunt nodes vastpinnen, favorieten bewaren, mini-playlists maken en delen.\n\n**Primaire databron**\n\n- Spotify Web API met Client Credentials Flow voor server-side calls. Voor preview gebruik je `preview_url` van Spotify tracks.\n- **Audius Public API** (gratis en open source) als extra bron voor trending tracks, remixes en community-curated playlists zonder commerci√´le beperkingen. Gebruik deze als alternatief wanneer Spotify rate-limt of wanneer je een demo zonder accounts wilt draaien.\n- Optioneel Last.fm en MusicBrainz als fallback of enrichment.\n\n**Platformen**\n\n- Webapp: React + Vite\n- Mobiel: React Native of .NET MAUI (beide haalbaar op basis van dezelfde backend)\n- Backend: Node.js + TypeScript (NestJS of Express), of .NET 8 Web API als alternatief\n- Database: PostgreSQL\n- Cache: Redis\n\n---\n\n## 2. Persona‚Äôs\n\n1. **Casual Explorer**\n    \n    Wil snel nieuwe artiesten ontdekken via klikken in de graaf, af en toe een preview luisteren, niets verplicht inloggen.\n    \n2. **Power Listener**\n    \n    Wil chain-discovery, pins, notities, mini-playlists en export naar Spotify.\n    \n3. **Curator**\n    \n    Wil vergelijkingen, thema‚Äôs, tags opslaan, b.v. ‚ÄúIndie folk om te studeren‚Äù.\n    \n---\n\n## 3. Use cases en user stories\n\n### UC-01 Artiest zoeken\n\n- Als gebruiker wil ik een artiest zoeken zodat ik die als vertrekpunt kan nemen.\n- Acceptatie:\n    - Zoek met autosuggest.\n    - Enter of klik op resultaat zet die artiest als centrale node.\n\n### UC-02 Gelijkaardige artiesten zien\n\n- Als gebruiker wil ik rond de centrale artiest 8 tot 12 gelijkaardige artiesten zien zodat ik verder kan verkennen.\n- Acceptatie:\n    - Nodes met ronde avatars, labels.\n    - Edges tussen centrum en buren.\n    - Geen duplicaten.\n\n### UC-03 Node interacties\n\n- Als gebruiker wil ik nodes kunnen verslepen en pinnen voor een eigen lay-out.\n- Als gebruiker wil ik op een node klikken en een contextmenu zien met: titel, Listen, More Similar Artists.\n- Acceptatie:\n    - Drag met veer-effect.\n    - Pin zet de node vast.\n    - Contextmenu sluit bij buitenklik of ESC.\n\n### UC-04 Meer gelijkaardigen laden\n\n- Als gebruiker wil ik op ‚ÄúMore Similar Artists‚Äù klikken om die node tot pivot te maken en nieuwe buren te zien.\n- Acceptatie:\n    - Lazy load, dedupe, animatie van edges.\n    - Nieuwe buren verschijnen in een ring rond de pivot.\n\n### UC-05 Luisterpreview\n\n- Als gebruiker wil ik 30-sec previews afspelen met play/pause en volume.\n- Acceptatie:\n    - E√©n globale player, nieuw nummer stopt het vorige.\n    - Indien geen preview: disabled actie en link ‚ÄúOpen in Spotify‚Äù.\n\n### UC-06 Favorieten en pins\n\n- Als gebruiker wil ik artiesten en playlists kunnen bewaren en nodes pinnen zodat ik later kan terugkeren.\n- Acceptatie:\n    - Favoriet-toggle per artiest.\n    - Behouden van pin status per sessie en per opgeslagen graaf.\n\n### UC-07 Sessies en graaf-snapshots\n\n- Als gebruiker wil ik mijn huidige graaf kunnen opslaan als snapshot en later opnieuw openen.\n- Acceptatie:\n    - Slaat nodes, posities, pins en timestamp op.\n    - Delen via deeplink.\n\n### UC-08 Exporteren naar Spotify\n\n- Als power user wil ik de geselecteerde tracks kunnen exporteren naar een Spotify playlist.\n- Acceptatie:\n    - Vereist OAuth Authorization Code flow.\n    - Gebruiker kiest naam, playlist wordt aangemaakt.\n\n### UC-09 Fallback en errors\n\n- Als gebruiker wil ik duidelijke meldingen bij API errors en rate limits.\n- Acceptatie:\n    - Netwerkfouten tonen toasts met retry.\n    - Rate limit backoff en waarschuwing.\n\n### UC-10 Toegankelijkheid\n\n- Als gebruiker met toetsenbord wil ik nodes en menu‚Äôs kunnen bedienen.\n- Acceptatie:\n    - Focus states, ARIA labels, contrast AA.\n\n---\n\n## 4. Functionele eisen\n\n- Sleepbare, zoomable graaf met collision-avoidance.\n- Radiale ring rond pivot bij eerste plaatsing, daarna lichte force simulatie.\n- Dedupe op artiest-id door volledige graaf.\n- Cache per artiest: related en top tracks.\n- Player met progress bar en volume.\n- Zoek met debounced autosuggest.\n- Snapshots en favorieten server-side opgeslagen per gebruiker.\n- Optioneel gastmodus met localStorage.\n\n---\n\n## 5. Niet-functionele eisen\n\n- TTFB voor initieel scherm onder 200 ms vanaf CDN.\n- API p95 \u003c 300 ms voor cached routes, \u003c 800 ms voor uncached.\n- 60 fps animatie bij \u003c 200 nodes op gemiddelde laptop.\n- A11y WCAG 2.1 AA.\n- Meertaligheid: NL, EN.\n- GDPR: enkel functionele data, geen gevoelige persoonsgegevens.\n\n---\n\n## 6. Informatiearchitectuur en schermen\n\n### 6.1 Web UI lay-out\n\n- Header: logo, zoekbalk, user menu.\n- Main:\n    - Linker 70 procent: graaf canvas.\n    - Rechter 30 procent: zijpaneel player en details.\n- Footer: volumeregelaar en transport.\n\n### 6.2 Belangrijke schermen\n\n1. Home: lege staat met zoekfocus.\n2. Discovery: graaf + details.\n3. Favorieten: lijst van artiesten.\n4. Snapshots: opgeslagen grafen met thumbnails.\n5. OAuth callback scherm.\n6. Settings: taal, thema licht/donker, marktcode voor top tracks.\n\n---\n\n## 7. UX-interacties\n\n- Node hover: vergroting 1.05, rand highlight, edges highlight.\n- Node drag: pointer-cursor, physics pauseren tot drop.\n- Contextmenu: vaste breedte 260 px, titelregel, actieknoppen.\n- Keyboard:\n    - Pijlen bewegen focus tussen nodes.\n    - Enter opent contextmenu.\n    - Space togglet play op geselecteerde track.\n- Empty states: duidelijke icon + boodschap + call to action.\n\n---\n\n## 8. Architectuur\n\n```\n[Client] React SPA\n   |\n   | HTTPS JSON\n   v\n[API] Node/TS (NestJS of Express)\n   |\\\n   | \\__ Audius proxy (open API)\n   |      v\n   |    [Audius Public API]\n   |\n   | Redis cache\n   v\n[PostgreSQL] gebruikers, snapshots, favorieten\n   |\n   | Spotify OAuth tokens\n   v\n[Spotify Web API]\n\n```\n\n- Server doet Spotify calls met Client Credentials voor publieke data.\n- Audius proxy gebruikt openbare endpoints en slaat geen secrets op; alleen caching/normalisatie in backend.\n- Voor user-acties zoals playlist creatie gebruik je Authorization Code flow.\n\n---\n\n## 9. Datamodel (PostgreSQL, Prisma-stijl)\n\n```\nmodel User {\n  id            String   @id @default(cuid())\n  provider      String   // 'anonymous' of 'spotify'\n  email         String?  @unique\n  displayName   String?\n  avatarUrl     String?\n  locale        String   @default(\"nl\")\n  market        String   @default(\"BE\")\n  createdAt     DateTime @default(now())\n  updatedAt     DateTime @updatedAt\n  snapshots     Snapshot[]\n  favorites     Favorite[]\n  settings      Json?\n  // OAuth tokens apart:\n  spotifyAuth   SpotifyAuth?\n}\n\nmodel SpotifyAuth {\n  id           String   @id @default(cuid())\n  userId       String   @unique\n  accessToken  String\n  refreshToken String\n  scope        String\n  expiresAt    DateTime\n  user         User     @relation(fields: [userId], references: [id])\n}\n\nmodel Favorite {\n  id        String   @id @default(cuid())\n  userId    String\n  artistId  String   // Spotify artist id\n  name      String\n  imageUrl  String?\n  addedAt   DateTime @default(now())\n  user      User     @relation(fields: [userId], references: [id])\n  @@unique([userId, artistId])\n}\n\nmodel Snapshot {\n  id         String   @id @default(cuid())\n  userId     String\n  title      String\n  createdAt  DateTime @default(now())\n  graphJson  Json     // nodes, edges, posities, pins\n  previewUrl String?  // optioneel thumbnail\n  user       User     @relation(fields: [userId], references: [id])\n}\n\nmodel AuditLog {\n  id        String   @id @default(cuid())\n  userId    String?\n  action    String\n  payload   Json?\n  createdAt DateTime @default(now())\n}\n\n```\n\n---\n\n## 10. Frontend datamodellen (TypeScript)\n\n```tsx\nexport type Artist = {\n  id: string;\n  name: string;\n  imageUrl?: string;\n  genres?: string[];\n  popularity?: number;\n};\n\nexport type Track = {\n  id: string;\n  name: string;\n  previewUrl?: string;\n  durationMs: number;\n  artists: { id: string; name: string }[];\n};\n\nexport type NodeData = {\n  id: string;           // unique per graph node\n  artistId: string;     // Spotify id\n  name: string;\n  imageUrl?: string;\n  pinned?: boolean;\n  x?: number; y?: number; fx?: number; fy?: number;\n};\n\nexport type EdgeData = { source: string; target: string };\n\nexport type GraphState = {\n  nodes: NodeData[];\n  edges: EdgeData[];\n  pivotNodeId: string;\n  loadedNeighbors: Record\u003cstring, string[]\u003e; // artistId -\u003e neighbor ids\n};\n\n```\n\n---\n\n## 11. API specificatie (REST)\n\nAlle routes onder `/api`. Responses zijn JSON. Tijdsformaat ISO 8601. Auth via JWT of session cookie. Rate limit 60 req/min per IP.\n\n### 11.1 Auth en gebruikers\n\n- `POST /auth/anonymous`\n    - Resultaat: `{ token, user: User }`\n- `GET /auth/spotify/login`\n    - Redirect naar Spotify\n- `GET /auth/spotify/callback?code=...`\n    - Resultaat: set session, redirect naar app\n- `POST /auth/logout`\n\n### 11.2 Spotify proxy\n\nServer-side om client te ontlasten en secrets te verbergen.\n\n- `GET /spotify/search?query=ben%20howard\u0026type=artist\u0026limit=10`\n    - Resultaat: `[{ id, name, imageUrl, genres, popularity }]`\n- `GET /spotify/artists/:id`\n    - Resultaat: `{ id, name, imageUrl, genres, popularity }`\n- `GET /spotify/artists/:id/related`\n    - Resultaat: `[{ ...Artist }]`\n- `GET /spotify/artists/:id/top-tracks?market=BE`\n    - Resultaat: `[{ ...Track }]`\n- `GET /spotify/tracks/:id`\n- `GET /spotify/audio-features/:id` (optioneel, voor eigen similarity)\n\nCaching: Redis 24 uur voor `related` en 6 uur voor `top-tracks`.\n\n### 11.3 Audius proxy (open API)\n\nGebruik de gratis Audius API via https://discoveryprovider.audius.co. Geen auth vereist, maar voeg een eenvoudige rate limiter toe.\n\n- `GET /audius/tracks/trending?genre=electronic\u0026limit=20`\n    - Resultaat: lijst met trending tracks inclusief `title`, `user`, `stream_url`.\n- `GET /audius/users/:handle/tracks`\n    - Resultaat: tracks per artiest/creator voor graafuitbreiding.\n- `GET /audius/tracks/:id/stream`\n    - Resultaat: directe stream-URL voor previews.\n\nCache responses max 10 minuten; Audius data verandert sneller en is toch gratis beschikbaar.\n\n### 11.4 App-data\n\n- `GET /me`\n    - Resultaat: `User`\n- `GET /favorites`\n- `POST /favorites`\n    - Body: `{ artistId, name, imageUrl }`\n- `DELETE /favorites/:artistId`\n- `GET /snapshots`\n- `POST /snapshots`\n    - Body: `{ title, graphJson }`\n- `GET /snapshots/:id`\n- `DELETE /snapshots/:id`\n\n### 11.5 Export\n\n- `POST /export/spotify-playlist`\n    - Auth vereist met Spotify scope `playlist-modify-public` of `playlist-modify-private`\n    - Body: `{ name, trackIds: string[] }`\n    - Resultaat: `{ playlistId, externalUrl }`\n\n### 11.6 Foutcodes\n\n- `400` validation_error\n- `401` unauthorized\n- `403` forbidden\n- `404` not_found\n- `409` conflict\n- `429` rate_limited\n- `500` server_error\n    \n    Body altijd `{ error: { code, message, details? } }`.\n    \n---\n\n## 12. Integratie met Spotify\n\n### 12.1 OAuth\n\n- Voor data zonder usercontext: **Client Credentials Flow** op de server.\n- Voor playlist export of user-gegevens: **Authorization Code Flow** met refresh tokens.\n\n### 12.2 Relevante endpoints\n\n- `GET /v1/search?type=artist\u0026q=...`\n- `GET /v1/artists/{id}`\n- `GET /v1/artists/{id}/related-artists`\n- `GET /v1/artists/{id}/top-tracks?market=BE`\n- `GET /v1/tracks/{id}`\n- `GET /v1/audio-features/{id}`\n\nVoorbeelden van genormaliseerde server-responses zijn hierboven gegeven. Bewaar geen Spotify secrets in de client.\n\n### 12.3 Audius integratie (optioneel)\n\n- Geen OAuth vereist, maar voeg een `User-Agent` header toe en respecteer `X-RateLimit` headers.\n- Normaliseer Audius response naar hetzelfde `Artist` en `Track` model (gebruik `user.name` als artiest, `stream_url` voor previews).\n- Markeer Audius-content in de UI (bijv. badge \"Audius\") zodat gebruikers weten dat het community-sourced is.\n- Gebruik Audius vooral in gastmodus of wanneer Spotify preview ontbreekt; fallback logic: eerst Spotify preview, anders Audius stream.\n\n---\n\n## 13. Algorithmische details\n\n### 13.1 Initieel plaatsen\n\n- Plaats pivot op canvas-centrum.\n- Plaats n buren op een cirkel met straal `R = k * sqrt(n)` en verdeling `angle = 2œÄi/n`.\n- Sla posities op in node.x, node.y en laat daarna een lichte force simulatie lopen.\n\n### 13.2 Force simulatie\n\n- Use case: overlap vermijden, organisch effect.\n- Krachten:\n    - Link force met lengte 150\n    - Charge negative 30\n    - Collision radius gelijk aan node-diameter + 4\n- Tijdens drag: zet fx, fy op muispositie. Bij drop verwijder fx, fy tenzij pinned.\n\n### 13.3 Dedupe\n\n- Nieuwe neighbor set: filter op `artistId` die al in `graphState.nodes` zit.\n- Edges: voeg enkel toe als combinatie nog niet bestaat.\n\n### 13.4 Prefetch en cache\n\n- Wanneer node in viewport en niet geladen: prefetch `related` en `top-tracks`.\n- Cache key: `artist:{id}:related` en `artist:{id}:topTracks:{market}`.\n\n---\n\n## 14. Componentarchitectuur (React)\n\n```\n\u003cApp\u003e\n  \u003cHeader\u003e\n    \u003cSearchBar /\u003e\n    \u003cUserMenu /\u003e\n  \u003c/Header\u003e\n\n  \u003cMain\u003e\n    \u003cGraphCanvas\n      graphState\n      onNodeClick\n      onNodeDrag\n      onPinToggle\n      onContextAction\n    /\u003e\n    \u003cSidePanel\u003e\n      \u003cArtistHeader /\u003e\n      \u003cTopTracks /\u003e\n      \u003cActions /\u003e\n    \u003c/SidePanel\u003e\n  \u003c/Main\u003e\n\n  \u003cFooter\u003e\n    \u003cGlobalPlayer /\u003e\n  \u003c/Footer\u003e\n\u003c/App\u003e\n\n```\n\nState management:\n\n- React Query voor data-fetch en cache.\n- Zustand of Redux Toolkit voor `GraphState` en player.\n\n---\n\n## 15. UI-richtlijnen\n\n- Node afmetingen: 96 px standaard, 120 px voor pivot.\n- Label max 20 tekens, ellipsis na 1 regel.\n- Edge 1 px lichtgrijs, opacity 0.6.\n- Thema licht en donker. Contrast minimaal AA.\n- Animaties: 150 tot 250 ms ease-in-out.\n- Contextmenu met duidelijke hit targets, 40 px hoogte per item.\n\n---\n\n## 16. Toegankelijkheid\n\n- Alle interacties via keyboard mogelijk.\n- Node als `button` met `aria-label=\"Artist: {name}\"`.\n- Contextmenu met roving tabindex.\n- Focusring 2 px zichtbaar.\n- Voor player: `aria-live=\"polite\"` bij trackwissel.\n\n---\n\n## 17. Internationalisatie\n\n- i18n keys in JSON, fallback EN.\n- Marktcode voor top tracks instelbaar in Settings.\n- Datum en getallen via Intl API.\n\n---\n\n## 18. Beveiliging en privacy\n\n- OAuth tokens server-side versleuteld (AES-GCM) met roterende key.\n- Cookies `HttpOnly`, `Secure`, `SameSite=Lax`.\n- CORS strikt op frontend origin.\n- Rate limiting en bot-protect op public routes.\n- CSP headers, Referrer-Policy, X-Content-Type-Options.\n- Log geen volledige tokens in audit.\n\n---\n\n## 19. Performance en schaalbaarheid\n\n- Vite bundling, code-splitting, lazy load voor SidePanel.\n- Afbeeldingen via `\u003cimg srcset\u003e` en CDNs, of proxied met cache.\n- Canvas rendering voor graaf bij \u003e 100 nodes.\n- API caching op Redis. Warm caches voor populaire artiesten.\n\n---\n\n## 20. Teststrategie\n\n### 20.1 Unit\n\n- Pure helpers: dedupe, layout, mappers van Spotify naar interne modellen.\n\n### 20.2 Integratie\n\n- API routes met mocked Spotify via MSW of WireMock.\n\n### 20.3 E2E\n\n- Playwright:\n    - Zoek artiest, laad graaf, klik node, luister preview, snapshot bewaren.\n\n### 20.4 Performancetests\n\n- Lighthouse en WebPageTest.\n- K6 voor backend, scenario met 50 rps bursts.\n\n### 20.5 Toegankelijkheid\n\n- axe-core geautomatiseerd in CI.\n\n---\n\n## 21. Telemetrie en analytics\n\n- Eventen: search_performed, node_opened, neighbors_loaded, track_preview_played, snapshot_saved, export_playlist.\n- Privacyvriendelijk, zonder PII.\n- Error tracking met Sentry.\n\n---\n\n## 22. CI/CD en deployment\n\n- Monorepo met Turbo of Nx.\n- CI: lint, typecheck, test, build, audit.\n- Docker images voor api en web.\n- Docker Compose voor dev.\n- Prod op Fly.io, Railway, Azure of AWS.\n- Migraties via Prisma Migrate.\n\n**Omgevingsvariabelen**\n\n```\nSPOTIFY_CLIENT_ID=\nSPOTIFY_CLIENT_SECRET=\nSPOTIFY_REDIRECT_URI=https://app.example.com/auth/spotify/callback\nJWT_SECRET=\nDATABASE_URL=postgres://...\nREDIS_URL=redis://...\nBASE_URL=https://api.example.com\n\n```\n\n---\n\n## 23. Backlog en roadmap\n\n### MVP\n\n- Zoek, discovery graaf, drag, contextmenu, listen, top tracks, favorieten lokaal.\n- Spotify proxy met Client Credentials.\n- Gastmodus.\n\n### V1\n\n- Accounts, server-side favorieten en snapshots.\n- Deelbare deeplinks.\n- Donker thema, i18n.\n\n### V2\n\n- Spotify playlist export via OAuth.\n- Fallback naar Last.fm bij lege related.\n- Eigen similarity op basis van audio features.\n\n---\n\n## 24. Acceptatiecriteria per kernfeature\n\n- **Zoek**: binnen 300 ms resultaten bij cache hit, geen XSS via query, keyboard navigatie ok.\n- **Graaf**: geen overlappende nodes in rust, drag performant, dedupe 100 procent.\n- **Listen**: preview start onder 200 ms bij cache hit, visual feedback playing.\n- **Snapshots**: POST met 201, GET levert identieke lay-out terug.\n- **Export**: playlist verschijnt in Spotify account en bevat juiste tracks.\n\n---\n\n## 25. Voorbeeld payloads\n\n### 25.1 `GET /spotify/search?query=ben howard\u0026type=artist`\n\n```json\n{\n  \"items\": [\n    {\n      \"id\": \"5schHn4kqRZfzJ6Tu2B3Yl\",\n      \"name\": \"Ben Howard\",\n      \"imageUrl\": \"https://i.scdn.co/image/...\",\n      \"genres\": [\"indie folk\", \"singer-songwriter\"],\n      \"popularity\": 67\n    }\n  ]\n}\n\n```\n\n### 25.2 `GET /spotify/artists/{id}/related`\n\n```json\n{\n  \"items\": [\n    { \"id\": \"0Z8k3Hc2\", \"name\": \"Bear's Den\", \"imageUrl\": \"...\" },\n    { \"id\": \"1aS9\", \"name\": \"Nick Mulvey\", \"imageUrl\": \"...\" }\n  ]\n}\n\n```\n\n### 25.3 `GET /spotify/artists/{id}/top-tracks?market=BE`\n\n```json\n{\n  \"items\": [\n    {\n      \"id\": \"3abc\",\n      \"name\": \"Only Love\",\n      \"previewUrl\": \"https://p.scdn.co/mp3-preview/...\",\n      \"durationMs\": 229000,\n      \"artists\": [{ \"id\": \"5sch...\", \"name\": \"Ben Howard\" }]\n    }\n  ]\n}\n\n```\n\n---\n\n## 26. Pseudocode kerndelen\n\n### 26.1 Neighbors laden en toevoegen\n\n```tsx\nasync function expandNode(pivotArtistId: string) {\n  if (graph.loadedNeighbors[pivotArtistId]) return;\n\n  const res = await api.getRelated(pivotArtistId);\n  const newArtists = res.items.filter(a =\u003e !graph.nodes.some(n =\u003e n.artistId === a.id));\n\n  const newNodes = newArtists.map((a, i) =\u003e ({\n    id: cuid(), artistId: a.id, name: a.name, imageUrl: a.imageUrl,\n    ...radialPosition(i, newArtists.length, pivotPosition())\n  }));\n\n  graph.nodes.push(...newNodes);\n  graph.edges.push(...newNodes.map(n =\u003e ({ source: findNodeIdByArtist(pivotArtistId), target: n.id })));\n  graph.loadedNeighbors[pivotArtistId] = newArtists.map(a =\u003e a.id);\n}\n\n```\n\n### 26.2 Player\n\n```tsx\nlet audio = new Audio();\nfunction playPreview(track: Track) {\n  if (!track.previewUrl) return;\n  audio.src = track.previewUrl;\n  audio.play();\n}\nfunction pause() { audio.pause(); }\n\n```\n\n---\n\n## 27. Styling en design system\n\n- Tailwind of CSS Variables.\n- Components: Button, Card, Menu, Tooltip, Tabs, Dialog.\n- Schaduwen zacht, afgeronde hoeken xl.\n- Preflight fonts: Inter of System UI.\n\n---\n\n## 28. Mobiele app aandachtspunten\n\n- Zelfde backend.\n- React Native: gebruik `react-native-svg` of `expo-three` voor graaf, of vereenvoudigde lijst-navigatie met horizontale carrousel als performance beperkt is.\n- .NET MAUI: canvas via SkiaSharp voor de graaf.\n- Offline: cache van laatst bezochte artiesten en snapshots in SQLite.\n\n---\n\n## 29. Licenties en content\n\n- Spotify preview_url en images mogen als preview gebruikt worden volgens Spotify TOS. Link altijd naar de artiest of track in Spotify bij detailweergave. Bewaar geen audio lokaal.\n\n---\n\n## 30. Things to remember tijdens implementatie\n\n- Duidelijke loading states en skeletons bij zijpaneel.\n- Dedupe strikt op Spotify artist id.\n- Backoff bij `429` met `Retry-After`.\n- Log elke Spotify call met endpoint, status, duur.\n- Feature flags voor export en eigen similarity.\n\n---\n\n## 31. Checklist om te starten\n\n1. Spotify app registreren en Client ID/Secret invullen.\n2. Backend scaffolding opzetten met healthcheck en √©√©n proxy route.\n3. Redis en Postgres draaien via Docker.\n4. Frontend met Vite, React Query, router.\n5. Basisgraaf renderen met dummy data.\n6. Echte `search` en `related` inbouwen.\n7. Player en SidePanel toevoegen.\n8. Favorieten en snapshots aansluiten op database.\n9. CI/CD pipeline.\n10. Lighthouse, axe en Playwright in CI.\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"space-y-8\",\"children\":[[\"$\",\"$Le\",null,{\"className\":\"mx-auto mt-4 max-w-3xl\"}],[\"$\",\"header\",null,{\"className\":\"space-y-3 rounded-xl border border-slate-200 bg-white p-6 shadow-sm\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl font-semibold text-gray-900\",\"children\":\"MusicDiscovery\"}],[\"$\",\"p\",null,{\"className\":\"text-base text-gray-600\",\"children\":\"Ontdek nieuwe artiesten via een interactieve graaf, beluister 30-seconden previews en bewaar snapshots van je ontdekkingstocht. De blueprint blijft beschikbaar als referentie maar de app hieronder is volledig interactief en draait op mockdata wanneer er geen backend aanwezig is.\"}]]}],[\"$\",\"$Lf\",null,{\"blueprint\":\"$10\"}]]}]\n"])</script></body></html>