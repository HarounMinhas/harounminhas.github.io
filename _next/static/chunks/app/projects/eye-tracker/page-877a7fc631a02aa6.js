(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[851],{3529:function(e,t,a){Promise.resolve().then(a.bind(a,596))},596:function(e,t,a){"use strict";a.r(t);var r=a(7437),i=a(2265);let s=[33,133,160,159,158,157,173,155,154,153,145,144,163,7,246,161],n=[362,263,387,386,385,384,398,382,381,380,374,373,390,249,466,388],l=(e,t,a)=>Number.isNaN(e)?t:Math.min(Math.max(e,t),a),c=(e,t,a)=>{let{width:r,height:i}=a,s=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,u=!1;if(t.forEach(t=>{let a=e[t];if(!a)return;let l=a.x,d=a.y;Number.isFinite(l)&&Number.isFinite(d)&&(1.5>=Math.abs(l)&&1.5>=Math.abs(d)&&(l*=r,d*=i),s=Math.min(s,l),n=Math.min(n,d),c=Math.max(c,l),o=Math.max(o,d),u=!0)}),!u)return null;let d=l(s,0,r),h=l(n,0,i);return{x:d,y:h,width:Math.max(0,l(c,0,r)-d),height:Math.max(0,l(o,0,i)-h)}};t.default=()=>{let e=(0,i.useRef)(null),t=(0,i.useRef)(null),l=(0,i.useRef)(null),o=(0,i.useRef)(),u=(0,i.useRef)(null),[d,h]=(0,i.useState)("Loading the eye tracking model. This usually takes a few seconds..."),[m,f]=(0,i.useState)(null),[y,g]=(0,i.useState)(!1),[x,p]=(0,i.useState)(!1),[b,v]=(0,i.useState)(!1),w=(0,i.useCallback)(()=>{let e=t.current;if(!e)return;let a=e.getContext("2d");a&&a.clearRect(0,0,e.width,e.height)},[]),N=(0,i.useCallback)(async()=>{let a=e.current,r=t.current,i=l.current;if(!a||!r||!i||a.readyState<HTMLMediaElement.HAVE_ENOUGH_DATA)return;(r.width!==a.videoWidth||r.height!==a.videoHeight)&&(r.width=a.videoWidth,r.height=a.videoHeight);let o=await i.estimateFaces(a,{flipHorizontal:!1}),u=r.getContext("2d");if(!u||(u.clearRect(0,0,r.width,r.height),!o.length))return;let{keypoints:d}=o[0],h={width:r.width,height:r.height},m=c(d,s,h),f=c(d,n,h);u.lineWidth=3,u.strokeStyle="#22d3ee",u.fillStyle="rgba(34, 211, 238, 0.2)",[m,f].forEach(e=>{e&&(u.fillRect(e.x,e.y,e.width,e.height),u.strokeRect(e.x,e.y,e.width,e.height))})},[]);(0,i.useEffect)(()=>{let t=!1;(async()=>{try{h("Loading the eye tracking model. This usually takes a few seconds...");let[{createDetector:e,SupportedModels:r},i]=await Promise.all([Promise.all([a.e(94),a.e(107),a.e(914)]).then(a.bind(a,5107)),Promise.all([a.e(94),a.e(682)]).then(a.bind(a,9094))]);if(await Promise.all([a.e(938),a.e(498),a.e(94),a.e(568),a.e(119)]).then(a.bind(a,1941)),await i.setBackend("webgl"),await i.ready(),t)return;let s=await e(r.MediaPipeFaceMesh,{runtime:"tfjs",refineLandmarks:!0,maxFaces:1});if(t){await s.dispose();return}l.current=s,p(!0),h("Model ready. Start the camera to begin tracking your eyes.")}catch(e){console.error(e),t||(f("We couldn't load the eye tracking model. Please refresh the page and try again."),h(""))}})();let r=e.current;return()=>{if(t=!0,o.current&&(cancelAnimationFrame(o.current),o.current=void 0),l.current&&(l.current.dispose(),l.current=null),r){r.pause();let{srcObject:e}=r;e instanceof MediaStream&&e.getTracks().forEach(e=>e.stop()),r.srcObject=null}u.current&&(u.current.getTracks().forEach(e=>e.stop()),u.current=null)}},[]),(0,i.useEffect)(()=>{if(!y)return;let e=!1,t=async()=>{e||(await N(),o.current=requestAnimationFrame(t))};return o.current=requestAnimationFrame(t),()=>{e=!0,o.current&&(cancelAnimationFrame(o.current),o.current=void 0)}},[y,N]),(0,i.useEffect)(()=>{y&&x&&h("Camera active. Keep your eyes in view to see the live tracking.")},[y,x]);let k=async()=>{var t;if(!(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.getUserMedia)){f("Camera access isn't supported in this browser. Please try a different one.");return}if(!b&&!y){f(null),v(!0);try{let t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!1});u.current=t;let a=e.current;if(!a)throw Error("Video element missing");a.srcObject=t,await a.play(),g(!0),h(x?"Camera active. Keep your eyes in view to see the live tracking.":"Camera active. Eye tracking will start as soon as the model finishes loading.")}catch(e){console.error(e),f("We couldn't access the camera. Please check your permissions and try again."),h("Camera inactive.")}finally{v(!1)}}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h1",{className:"text-3xl font-semibold",children:"Live Eye Tracking Camera"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Allow camera access to preview the live video feed. Once the model detects your face, glowing squares will follow your eyes in real time."})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:k,disabled:b||y,className:"rounded-md bg-sky-500 px-4 py-2 text-white transition hover:bg-sky-600 disabled:cursor-not-allowed disabled:opacity-60",children:b?"Starting camera...":"Start camera"}),y&&(0,r.jsx)("button",{type:"button",onClick:()=>{let t=e.current;(null==t?void 0:t.srcObject)instanceof MediaStream&&(t.srcObject.getTracks().forEach(e=>e.stop()),t.srcObject=null),u.current&&(u.current.getTracks().forEach(e=>e.stop()),u.current=null),null==t||t.pause(),w(),g(!1),h("Camera stopped. Start the camera again to resume tracking.")},className:"rounded-md border border-gray-300 px-4 py-2 text-gray-700 transition hover:bg-gray-100",children:"Stop camera"})]}),(0,r.jsxs)("div",{className:"relative w-full max-w-3xl overflow-hidden rounded-xl bg-black",children:[(0,r.jsx)("video",{ref:e,className:"h-full w-full object-cover",playsInline:!0,autoPlay:!0,muted:!0}),(0,r.jsx)("canvas",{ref:t,className:"pointer-events-none absolute inset-0 h-full w-full"}),!y&&(0,r.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center px-6 text-center text-sm font-medium text-white/80",children:"Camera preview will appear here once you start the camera."})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[d&&(0,r.jsx)("p",{className:"text-sm text-gray-700",children:d}),m&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:m})]}),(0,r.jsxs)("div",{className:"space-y-2 rounded-lg border border-dashed border-gray-300 bg-gray-50 p-4 text-sm text-gray-600",children:[(0,r.jsx)("p",{className:"font-medium",children:"Tips for best results"}),(0,r.jsxs)("ul",{className:"list-disc space-y-1 pl-5",children:[(0,r.jsx)("li",{children:"Make sure you are in a well-lit environment so your eyes are easy to detect."}),(0,r.jsx)("li",{children:"Position your face roughly one arm's length away from the camera."}),(0,r.jsx)("li",{children:"Keep your eyes visible and avoid heavy glare from glasses."})]})]})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=3529)}),_N_E=e.O()}]);