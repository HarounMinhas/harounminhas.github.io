"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[253],{5253:function(e,t,r){r.d(t,{default:function(){return j}});var a=r(7437),s=r(2265),l=r(9376),n=r(1525);function i(e){let{children:t,className:r}=e;return(0,a.jsx)("span",{className:"rounded px-2 py-0.5 text-xs ".concat(r),children:t})}function o(e){let{type:t}=e;return t?(0,a.jsx)(i,{className:"bg-blue-100 text-blue-800",children:t.replace(/_/g," ")}):null}function c(e){let{text:t}=e;return(0,a.jsx)(i,{className:"bg-yellow-100 text-yellow-800",children:t})}function d(e){let{text:t}=e;return(0,a.jsx)(i,{className:"bg-green-100 text-green-800",children:t})}function u(){return(0,a.jsx)(i,{className:"bg-pink-100 text-pink-800",children:"Sponsored"})}function p(e){var t,r,s,l,n;let{item:i,onClick:p}=e,g=[i.profile.city,i.profile.country].filter(Boolean).join(", "),h=i.rewards&&i.rewards.rewardTypes&&i.rewards.rewardTypes.length>0;return(0,a.jsxs)("button",{onClick:p,className:"flex w-full flex-col overflow-hidden rounded border bg-white text-left shadow-sm hover:shadow-md focus:outline-none focus:ring","aria-label":"View details for ".concat(i.title),children:[(0,a.jsx)("div",{className:"h-40 w-full overflow-hidden bg-gray-100",children:i.profile.profileImageUrl?(0,a.jsx)("img",{src:i.profile.profileImageUrl,alt:"".concat(i.profile.organizationName," logo"),className:"h-full w-full object-cover"}):(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center text-gray-400",children:"No image"})}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col gap-2 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:i.title}),(null===(t=i.boost)||void 0===t?void 0:t.isHighlighted)&&(0,a.jsx)(u,{})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsx)("span",{children:i.profile.organizationName}),i.profile.verified?(0,a.jsx)("span",{className:"ml-1","aria-label":"verified",children:"✔️"}):null]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:g}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-1",children:[(0,a.jsx)(o,{type:i.type}),(0,a.jsx)(c,{text:function(e){if("FREE"===e.fee)return"Free";if(e.applicationFees&&e.applicationFees.length>0){let t=e.applicationFees[0];return"".concat(t.price," ").concat(t.currency)}return e.fee?e.fee:"No fee"}(i)}),h?i.rewards.rewardTypes.map(e=>(0,a.jsx)(d,{text:e},e)):(null===(r=i.rewards)||void 0===r?void 0:r.rewardDescription)&&(0,a.jsx)(d,{text:i.rewards.rewardDescription.slice(0,20)})]}),(0,a.jsx)("div",{className:"text-sm text-gray-700",children:(n=null===(l=i.description)||void 0===l?void 0:null===(s=l[0])||void 0===s?void 0:s.content)?n.replace(/\n+/g," ").slice(0,200)+(n.length>200?"…":""):""}),(0,a.jsxs)("div",{className:"mt-auto text-sm font-medium",children:["Deadline: ",function(e){if(!e)return"No deadline";try{return new Date(e).toLocaleDateString()}catch(t){return e}}(i.deadline)]})]})]})}function g(){return(0,a.jsxs)("div",{className:"flex w-full flex-col overflow-hidden rounded border bg-white p-4 shadow-sm animate-pulse",children:[(0,a.jsx)("div",{className:"mb-4 h-40 w-full bg-gray-200"}),(0,a.jsx)("div",{className:"mb-2 h-4 w-3/4 bg-gray-200"}),(0,a.jsx)("div",{className:"mb-2 h-3 w-1/2 bg-gray-200"}),(0,a.jsx)("div",{className:"h-3 w-full bg-gray-200"})]})}function h(e){let{page:t,totalPages:r,onPageChange:s}=e;if(!r||r<=1)return null;let l=Array.from({length:r},(e,t)=>t+1);return(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-2","aria-label":"Pagination navigation",children:[(0,a.jsx)("button",{className:"rounded border px-2 py-1 text-sm disabled:opacity-50",onClick:()=>s(t-1),disabled:t<=1,"aria-label":"Previous page",children:"Prev"}),l.map(e=>(0,a.jsx)("button",{className:"rounded border px-2 py-1 text-sm ".concat(e===t?"bg-gray-200":""),onClick:()=>s(e),"aria-current":e===t?"page":void 0,children:e},e)),(0,a.jsx)("button",{className:"rounded border px-2 py-1 text-sm disabled:opacity-50",onClick:()=>s(t+1),disabled:t>=r,"aria-label":"Next page",children:"Next"})]})}function f(e){let{value:t,onChange:r}=e;return(0,a.jsxs)("select",{"aria-label":"Sort opportunities",className:"rounded border px-2 py-1 text-sm",value:t,onChange:e=>r(e.target.value),children:[(0,a.jsx)("option",{value:"-deadline",children:"Deadline (latest)"}),(0,a.jsx)("option",{value:"deadline",children:"Deadline (earliest)"}),(0,a.jsx)("option",{value:"-createdAt",children:"Newest"})]})}function m(e){let{value:t,onChange:r}=e;return(0,a.jsxs)("select",{"aria-label":"Items per page",className:"rounded border px-2 py-1 text-sm",value:String(t),onChange:e=>r(e.target.value),children:[(0,a.jsx)("option",{value:"0",children:"All"}),(0,a.jsx)("option",{value:"6",children:"6"}),(0,a.jsx)("option",{value:"12",children:"12"}),(0,a.jsx)("option",{value:"24",children:"24"})]})}function x(e){let{label:t,options:r,selected:l,onChange:n}=e,[i,o]=(0,s.useState)(!1),c=e=>{l.includes(e)?n(l.filter(t=>t!==e)):n([...l,e])};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{type:"button","aria-haspopup":"listbox","aria-expanded":i,onClick:()=>o(e=>!e),className:"rounded border px-2 py-1 text-sm",children:l.length?"".concat(t," (").concat(l.length,")"):t}),i&&(0,a.jsx)("div",{className:"absolute z-10 mt-1 w-56 max-h-60 overflow-y-auto rounded border bg-white shadow",children:r.map(e=>(0,a.jsxs)("label",{className:"flex cursor-pointer gap-2 border-b p-2 last:border-b-0",children:[(0,a.jsx)("input",{type:"checkbox",className:"form-checkbox mt-1",checked:l.includes(e.value),onChange:()=>c(e.value)}),(0,a.jsxs)("span",{className:"text-sm",children:[e.label,e.description&&(0,a.jsx)("small",{className:"block text-xs text-gray-500",children:e.description})]})]},e.value))})]})}function y(e){let{type:t=[],city:r=[],country:s=[],pageLength:l,onChange:n,typeOptions:i=[],countryOptions:o=[],cityOptions:c=[]}=e;return(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)(x,{label:"Type",options:i,selected:t,onChange:e=>n("type",e)}),(0,a.jsx)(x,{label:"Country",options:o,selected:s,onChange:e=>n("country",e)}),(0,a.jsx)(x,{label:"City",options:c,selected:r,onChange:e=>n("city",e)}),(0,a.jsx)(m,{value:l,onChange:e=>n("pageLength",e)})]})}function j(){let e=(0,l.useSearchParams)(),t=(0,l.useRouter)(),r=e.get("sortBy")||"-deadline",i=parseInt(e.get("page")||"1",10),o=e.get("type")||"",c=e.get("country")||"",d=e.get("city")||"",u=e.get("search")||"",m=(0,s.useMemo)(()=>o?o.split(",").filter(Boolean):[],[o]),x=(0,s.useMemo)(()=>c?c.split(",").filter(Boolean):[],[c]),j=(0,s.useMemo)(()=>d?d.split(",").filter(Boolean):[],[d]),v=e.get("pageLength"),b=v?parseInt(v,10):6,[N,w]=(0,s.useState)([]),[S,C]=(0,s.useState)(null),[k,A]=(0,s.useState)(!0),[P,L]=(0,s.useState)(null),[E,D]=(0,s.useState)([]),[I,R]=(0,s.useState)([]),[B,U]=(0,s.useState)([]);(0,s.useEffect)(()=>{if(!e.toString()){let e=sessionStorage.getItem("opportunity-search");e&&t.replace("/opportunities?".concat(e))}},[]),(0,s.useEffect)(()=>{sessionStorage.setItem("opportunity-search",e.toString())},[e.toString()]),(0,s.useEffect)(()=>{let e=!1,t=sessionStorage.getItem("all-opportunities");if(t)try{let e=JSON.parse(t);w(e)}catch(e){}return async function(){try{let t=await (0,n.Oj)();if(e)return;let r=t.map(e=>e.id).join(","),a=N.map(e=>e.id).join(",");r!==a&&(w(t),sessionStorage.setItem("all-opportunities",JSON.stringify(t)))}catch(e){console.error(e)}}(),()=>{e=!0}},[]),(0,s.useEffect)(()=>{let e=Array.from(new Set(N.map(e=>e.type).filter(e=>!!e))).sort(),t=Array.from(new Set(N.map(e=>{var t;return null===(t=e.profile)||void 0===t?void 0:t.country}).filter(e=>!!e))).sort(),r=Array.from(new Set(N.map(e=>{var t;return null===(t=e.profile)||void 0===t?void 0:t.city}).filter(e=>!!e))).sort();D(e.map(e=>({value:e,label:e}))),R(t.map(e=>({value:e,label:e}))),U(r.map(e=>({value:e,label:e})))},[N]),(0,s.useEffect)(()=>{A(!0),L(null);try{let e=N;if(m.length&&(e=e.filter(e=>e.type&&m.includes(e.type))),x.length&&(e=e.filter(e=>{var t;return(null===(t=e.profile)||void 0===t?void 0:t.country)&&x.includes(e.profile.country)})),j.length&&(e=e.filter(e=>{var t;return(null===(t=e.profile)||void 0===t?void 0:t.city)&&j.includes(e.profile.city)})),u){let t=u.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(t))}let t=r.startsWith("-")?r.slice(1):r,a=r.startsWith("-")?-1:1;e=e.slice().sort((e,r)=>{let s=e[t],l=r[t];if(!s||!l)return 0;let n=Date.parse(s),i=Date.parse(l);return Number.isNaN(n)||Number.isNaN(i)?String(s).localeCompare(String(l))*a:(n-i)*a});let s=b?Math.ceil(e.length/b):1,l=b?(i-1)*b:0,n=b?e.slice(l,l+b):e;C({data:n,pages:b?s:void 0,entries:e.length})}catch(e){L(e.message)}finally{A(!1)}},[N,r,i,m,x,j,b,u]);let O=e=>{t.push("/opportunities?".concat(e.toString()))},F=t=>{let r=new URLSearchParams(e.toString());r.set("sortBy",t),r.set("page","1"),O(r)},_=r=>{let a=new URLSearchParams(e.toString());a.set("id",r),t.push("/opportunities?".concat(a.toString()))};return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-4 flex flex-col gap-2",children:[(0,a.jsx)(y,{type:m,country:x,city:j,pageLength:b,onChange:(t,r)=>{let a=new URLSearchParams(e.toString());Array.isArray(r)?r.length?a.set(t,r.join(",")):a.delete(t):r?a.set(t,r):a.delete(t),a.set("page","1"),O(a)},typeOptions:E,countryOptions:I,cityOptions:B}),(0,a.jsx)("div",{className:"flex items-center justify-end",children:(0,a.jsx)(f,{value:r,onChange:F})})]}),P&&(0,a.jsxs)("div",{className:"mb-4 rounded border border-red-200 bg-red-50 p-4",children:[(0,a.jsx)("p",{className:"text-red-700",children:"Failed to load opportunities."}),(0,a.jsx)("button",{className:"mt-2 rounded border px-2 py-1",onClick:()=>F(r),"aria-label":"Retry loading opportunities",children:"Retry"})]}),k?(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:b||6}).map((e,t)=>(0,a.jsx)(g,{},t))}):(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:null==S?void 0:S.data.map(e=>(0,a.jsx)(p,{item:e,onClick:()=>_(e.id)},e.id))}),!k&&!P&&0!==b&&(0,a.jsx)(h,{page:i,totalPages:null==S?void 0:S.pages,onPageChange:t=>{let r=new URLSearchParams(e.toString());r.set("page",String(t)),O(r)}})]})}},1525:function(e,t,r){r.d(t,{N9:function(){return s},Oj:function(){return n},ZY:function(){return l}});let a="https://api.artconnect.com/v1";async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URL(a+"/opportunities/");if(e.sortBy&&t.searchParams.set("sortBy",e.sortBy),e.page&&t.searchParams.set("page",String(e.page)),e.type){let r=Array.isArray(e.type)?e.type.join(","):e.type;t.searchParams.set("type",r)}if(e.country){let r=Array.isArray(e.country)?e.country.join(","):e.country;t.searchParams.set("country",r)}if(e.city){let r=Array.isArray(e.city)?e.city.join(","):e.city;t.searchParams.set("city",r)}void 0!==e.pageLength&&t.searchParams.set("pageLength",String(e.pageLength)),e.search&&t.searchParams.set("search",e.search);let r=await fetch(t.toString(),{headers:{Accept:"application/json"}});if(!r.ok)throw Error("List fetch failed: ".concat(r.status));return await r.json()}async function l(e){let t=await fetch("".concat(a,"/opportunities/").concat(encodeURIComponent(e),"/"),{headers:{Accept:"application/json"}});if(!t.ok)throw Error("Detail fetch failed: ".concat(t.status));return await t.json()}async function n(){let e=1,t=[];for(;;){let r=await s({page:e,pageLength:100});if(t.push(...r.data),!r.pages||e>=r.pages)break;e++}return t}}}]);