"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[253],{5253:function(e,t,a){a.d(t,{default:function(){return y}});var r=a(7437),s=a(2265),l=a(9376),n=a(1525);function i(e){let{children:t,className:a}=e;return(0,r.jsx)("span",{className:"rounded px-2 py-0.5 text-xs ".concat(a),children:t})}function o(e){let{type:t}=e;return t?(0,r.jsx)(i,{className:"bg-blue-100 text-blue-800",children:t.replace(/_/g," ")}):null}function c(e){let{text:t}=e;return(0,r.jsx)(i,{className:"bg-yellow-100 text-yellow-800",children:t})}function d(e){let{text:t}=e;return(0,r.jsx)(i,{className:"bg-green-100 text-green-800",children:t})}function u(){return(0,r.jsx)(i,{className:"bg-pink-100 text-pink-800",children:"Sponsored"})}function p(e){var t,a,s,l,n;let{item:i,onClick:p}=e,g=[i.profile.city,i.profile.country].filter(Boolean).join(", "),h=i.rewards&&i.rewards.rewardTypes&&i.rewards.rewardTypes.length>0;return(0,r.jsxs)("button",{onClick:p,className:"flex w-full flex-col overflow-hidden rounded border bg-white text-left shadow-sm hover:shadow-md focus:outline-none focus:ring","aria-label":"View details for ".concat(i.title),children:[(0,r.jsx)("div",{className:"h-40 w-full overflow-hidden bg-gray-100",children:i.profile.profileImageUrl?(0,r.jsx)("img",{src:i.profile.profileImageUrl,alt:"".concat(i.profile.organizationName," logo"),className:"h-full w-full object-cover"}):(0,r.jsx)("div",{className:"flex h-full w-full items-center justify-center text-gray-400",children:"No image"})}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col gap-2 p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:i.title}),(null===(t=i.boost)||void 0===t?void 0:t.isHighlighted)&&(0,r.jsx)(u,{})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,r.jsx)("span",{children:i.profile.organizationName}),i.profile.verified?(0,r.jsx)("span",{className:"ml-1","aria-label":"verified",children:"✔️"}):null]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:g}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-1",children:[(0,r.jsx)(o,{type:i.type}),(0,r.jsx)(c,{text:function(e){if("FREE"===e.fee)return"Free";if(e.applicationFees&&e.applicationFees.length>0){let t=e.applicationFees[0];return"".concat(t.price," ").concat(t.currency)}return e.fee?e.fee:"No fee"}(i)}),h?i.rewards.rewardTypes.map(e=>(0,r.jsx)(d,{text:e},e)):(null===(a=i.rewards)||void 0===a?void 0:a.rewardDescription)&&(0,r.jsx)(d,{text:i.rewards.rewardDescription.slice(0,20)})]}),(0,r.jsx)("div",{className:"text-sm text-gray-700",children:(n=null===(l=i.description)||void 0===l?void 0:null===(s=l[0])||void 0===s?void 0:s.content)?n.replace(/\n+/g," ").slice(0,200)+(n.length>200?"…":""):""}),(0,r.jsxs)("div",{className:"mt-auto text-sm font-medium",children:["Deadline: ",function(e){if(!e)return"No deadline";try{return new Date(e).toLocaleDateString()}catch(t){return e}}(i.deadline)]})]})]})}function g(){return(0,r.jsxs)("div",{className:"flex w-full flex-col overflow-hidden rounded border bg-white p-4 shadow-sm animate-pulse",children:[(0,r.jsx)("div",{className:"mb-4 h-40 w-full bg-gray-200"}),(0,r.jsx)("div",{className:"mb-2 h-4 w-3/4 bg-gray-200"}),(0,r.jsx)("div",{className:"mb-2 h-3 w-1/2 bg-gray-200"}),(0,r.jsx)("div",{className:"h-3 w-full bg-gray-200"})]})}function h(e){let{page:t,totalPages:a,onPageChange:s}=e;if(!a||a<=1)return null;let l=Array.from({length:a},(e,t)=>t+1);return(0,r.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-2","aria-label":"Pagination navigation",children:[(0,r.jsx)("button",{className:"rounded border px-2 py-1 text-sm disabled:opacity-50",onClick:()=>s(t-1),disabled:t<=1,"aria-label":"Previous page",children:"Prev"}),l.map(e=>(0,r.jsx)("button",{className:"rounded border px-2 py-1 text-sm ".concat(e===t?"bg-gray-200":""),onClick:()=>s(e),"aria-current":e===t?"page":void 0,children:e},e)),(0,r.jsx)("button",{className:"rounded border px-2 py-1 text-sm disabled:opacity-50",onClick:()=>s(t+1),disabled:t>=a,"aria-label":"Next page",children:"Next"})]})}function m(e){let{value:t,onChange:a}=e;return(0,r.jsxs)("select",{"aria-label":"Sort opportunities",className:"rounded border px-2 py-1 text-sm",value:t,onChange:e=>a(e.target.value),children:[(0,r.jsx)("option",{value:"-deadline",children:"Deadline (latest)"}),(0,r.jsx)("option",{value:"deadline",children:"Deadline (earliest)"}),(0,r.jsx)("option",{value:"-createdAt",children:"Newest"})]})}function f(e){let{value:t,onChange:a}=e;return(0,r.jsxs)("select",{"aria-label":"Items per page",className:"rounded border px-2 py-1 text-sm",value:String(t),onChange:e=>a(e.target.value),children:[(0,r.jsx)("option",{value:"0",children:"All"}),(0,r.jsx)("option",{value:"6",children:"6"}),(0,r.jsx)("option",{value:"12",children:"12"}),(0,r.jsx)("option",{value:"24",children:"24"})]})}function x(e){let{label:t,options:a,selected:l,onChange:n}=e,[i,o]=(0,s.useState)(!1),c=e=>{l.includes(e)?n(l.filter(t=>t!==e)):n([...l,e])};return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{type:"button","aria-haspopup":"listbox","aria-expanded":i,onClick:()=>o(e=>!e),className:"rounded border px-2 py-1 text-sm",children:l.length?"".concat(t," (").concat(l.length,")"):t}),i&&(0,r.jsx)("div",{className:"absolute z-10 mt-1 w-56 max-h-60 overflow-y-auto rounded border bg-white shadow",children:a.map(e=>(0,r.jsxs)("label",{className:"flex cursor-pointer gap-2 border-b p-2 last:border-b-0",children:[(0,r.jsx)("input",{type:"checkbox",className:"form-checkbox mt-1",checked:l.includes(e.value),onChange:()=>c(e.value)}),(0,r.jsxs)("span",{className:"text-sm",children:[e.label,e.description&&(0,r.jsx)("small",{className:"block text-xs text-gray-500",children:e.description})]})]},e.value))})]})}function v(e){let{type:t=[],city:a=[],country:s=[],pageLength:l,onChange:n,typeOptions:i=[],countryOptions:o=[],cityOptions:c=[]}=e;return(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsx)(x,{label:"Type",options:i,selected:t,onChange:e=>n("type",e)}),(0,r.jsx)(x,{label:"Country",options:o,selected:s,onChange:e=>n("country",e)}),(0,r.jsx)(x,{label:"City",options:c,selected:a,onChange:e=>n("city",e)}),(0,r.jsx)(f,{value:l,onChange:e=>n("pageLength",e)})]})}function y(){let e=(0,l.useSearchParams)(),t=(0,l.useRouter)(),a=e.get("sortBy")||"-deadline",i=parseInt(e.get("page")||"1",10),o=e.get("type")||"",c=e.get("country")||"",d=e.get("city")||"",u=e.get("search")||"",f=(0,s.useMemo)(()=>o?o.split(",").filter(Boolean):[],[o]),x=(0,s.useMemo)(()=>c?c.split(",").filter(Boolean):[],[c]),y=(0,s.useMemo)(()=>d?d.split(",").filter(Boolean):[],[d]),j=e.get("pageLength"),b=j?parseInt(j,10):6,[w,N]=(0,s.useState)([]),[S,C]=(0,s.useState)(null),[k,P]=(0,s.useState)(!0),[L,A]=(0,s.useState)(null),[E,I]=(0,s.useState)([]),[R,D]=(0,s.useState)([]),[U,O]=(0,s.useState)([]),[T,B]=(0,s.useState)(0);(0,s.useEffect)(()=>{if(!e.toString()){let e=sessionStorage.getItem("opportunity-search");e&&t.replace("/opportunities?".concat(e))}},[]),(0,s.useEffect)(()=>{sessionStorage.setItem("opportunity-search",e.toString())},[e.toString()]),(0,s.useEffect)(()=>{let e=!1,t=sessionStorage.getItem("all-opportunities");if(t)try{let e=JSON.parse(t);N(e),B(100);return}catch(e){}return async function(){try{await (0,n.Oj)((t,a,r)=>{!e&&(N(t),sessionStorage.setItem("all-opportunities",JSON.stringify(t)),r&&B(a/r*100))},100)}catch(e){console.error(e),A(e.message)}}(),()=>{e=!0}},[]),(0,s.useEffect)(()=>{let e=Array.from(new Set(w.map(e=>e.type).filter(e=>!!e))).sort(),t=Array.from(new Set(w.map(e=>{var t;return null===(t=e.profile)||void 0===t?void 0:t.country}).filter(e=>!!e))).sort(),a=Array.from(new Set(w.map(e=>{var t;return null===(t=e.profile)||void 0===t?void 0:t.city}).filter(e=>!!e))).sort();I(e.map(e=>({value:e,label:e}))),D(t.map(e=>({value:e,label:e}))),O(a.map(e=>({value:e,label:e})))},[w]),(0,s.useEffect)(()=>{P(!0),A(null);try{let e=w;if(f.length&&(e=e.filter(e=>e.type&&f.includes(e.type))),x.length&&(e=e.filter(e=>{var t;return(null===(t=e.profile)||void 0===t?void 0:t.country)&&x.includes(e.profile.country)})),y.length&&(e=e.filter(e=>{var t;return(null===(t=e.profile)||void 0===t?void 0:t.city)&&y.includes(e.profile.city)})),u){let t=u.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(t))}let t=a.startsWith("-")?a.slice(1):a,r=a.startsWith("-")?-1:1;e=e.slice().sort((e,a)=>{let s=e[t],l=a[t];if(!s||!l)return 0;let n=Date.parse(s),i=Date.parse(l);return Number.isNaN(n)||Number.isNaN(i)?String(s).localeCompare(String(l))*r:(n-i)*r});let s=b?Math.ceil(e.length/b):1,l=b?(i-1)*b:0,n=b?e.slice(l,l+b):e;C({data:n,pages:b?s:void 0,entries:e.length})}catch(e){A(e.message)}finally{P(!1)}},[w,a,i,f,x,y,b,u]);let F=e=>{t.push("/opportunities?".concat(e.toString()))},M=t=>{let a=new URLSearchParams(e.toString());a.set("sortBy",t),a.set("page","1"),F(a)},_=a=>{let r=new URLSearchParams(e.toString());r.set("id",a),t.push("/opportunities?".concat(r.toString()))};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-4 flex flex-col gap-2",children:[(0,r.jsx)(v,{type:f,country:x,city:y,pageLength:b,onChange:(t,a)=>{let r=new URLSearchParams(e.toString());Array.isArray(a)?a.length?r.set(t,a.join(",")):r.delete(t):a?r.set(t,a):r.delete(t),r.set("page","1"),F(r)},typeOptions:E,countryOptions:R,cityOptions:U}),(0,r.jsx)("div",{className:"flex items-center justify-end",children:(0,r.jsx)(m,{value:a,onChange:M})})]}),T>0&&T<100&&(0,r.jsx)("div",{className:"progress mb-4",children:(0,r.jsxs)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(T,"%")},"aria-valuenow":T,"aria-valuemin":0,"aria-valuemax":100,children:[Math.round(T),"%"]})}),L&&(0,r.jsxs)("div",{className:"mb-4 rounded border border-red-200 bg-red-50 p-4",children:[(0,r.jsx)("p",{className:"text-red-700",children:"Failed to load opportunities."}),(0,r.jsx)("button",{className:"mt-2 rounded border px-2 py-1",onClick:()=>M(a),"aria-label":"Retry loading opportunities",children:"Retry"})]}),!k||(null==S?void 0:S.data.length)?(0,r.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:null==S?void 0:S.data.map(e=>(0,r.jsx)(p,{item:e,onClick:()=>_(e.id)},e.id))}):(0,r.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:b||6}).map((e,t)=>(0,r.jsx)(g,{},t))}),!L&&S&&0!==b&&(0,r.jsx)(h,{page:i,totalPages:S.pages,onPageChange:t=>{let a=new URLSearchParams(e.toString());a.set("page",String(t)),F(a)}})]})}},1525:function(e,t,a){a.d(t,{Oj:function(){return n},ZY:function(){return l}});let r="https://api.artconnect.com/v1";async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=new URL(r+"/opportunities/");t.searchParams.set("page",String(e));let a=await fetch(t.toString(),{headers:{Accept:"application/json"}});if(409===a.status)throw Error("409");if(!a.ok)throw Error("List fetch failed: ".concat(a.status));return await a.json()}async function l(e){async function t(){let a=await fetch("".concat(r,"/opportunities/").concat(encodeURIComponent(e),"/"),{headers:{Accept:"application/json"}});return a.ok?await a.json():(await new Promise(e=>setTimeout(e,2e3)),t())}return t()}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a=1,r=[];for(;;){let l;try{l=await s(a)}catch(e){await new Promise(e=>setTimeout(e,2e3));continue}if(r.push(...l.data),e&&e(r.slice(),a,l.pages),!l.pages||a>=l.pages)break;a++,t>0&&await new Promise(e=>setTimeout(e,t))}return r}}}]);